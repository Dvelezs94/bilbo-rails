$(document).on('turbolinks:load', function() {
function initializeMap() {
  var bilbos = <%= Board.enabled.select(:id, :lat, :lng).to_json %>
  // center of mexico
  var center = new google.maps.LatLng(23.959124, -102.482976);

  var map = new google.maps.Map(document.getElementById('bilbomap'), {
    zoom: 5,
    center: center,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  });

  // build markers from the available bilbos
  var markers = bilbos.map(function(bilbo) {
    var marker = new google.maps.Marker({
      position: bilbo
    });

    if ($("#bilbomap").length > 0){
      google.maps.event.addListener(marker, 'click', function() {
        alert('marker ' + marker.getPosition() + ' clicked');
        $.ajax({
           url:  "/users/select_users",
           dataType: "json",
           data: {
              prezzario: ui.item.value
           },
           success: function(data) {
              var r = $.parseJSON(data);
              console.log(r.users)//This is where Your users are
           }
        });
      });
    }

    return marker;
  });

  var options = {
    imagePath: "https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"
  };

  var markerCluster = new MarkerClusterer(map, markers, options);

  console.log(bilbos);

}

  if ($("#bilbomap").length > 0){
    google.maps.event.addDomListener(window, 'turbolinks:load', initializeMap);
  }
});
